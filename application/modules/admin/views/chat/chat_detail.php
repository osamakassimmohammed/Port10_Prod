<style type="text/css">
    .home_active {
        font-weight: 600 !important;
        color: #c09550 !important;
    }

    .contnr_main_headr.hedr_fixed {
        position: static;
        box-shadow: 0px 0px 0px #fff;
    }

    /*______________CHAT_UI________________*/

    .container {
        max-width: 1170px;
        margin: auto;
    }

    img {
        max-width: 100%;
    }

    .inbox_people {
        background: #f8f8f8 none repeat scroll 0 0;
        float: left;
        overflow: hidden;
        width: 40%;
        border-right: 1px solid #c4c4c4;
    }

    .inbox_msg {
        border: 1px solid #c4c4c4;
        clear: both;
        overflow: hidden;
    }

    .top_spac {
        margin: 20px 0 0;
    }

    .recent_heading {
        float: left;
        width: 40%;
    }

    .srch_bar {
        display: inline-block;
        text-align: right;
        width: 60%;
        padding:
    }

    .headind_srch {
        padding: 10px 29px 10px 20px;
        overflow: hidden;
        border-bottom: 1px solid #c4c4c4;
    }

    .recent_heading h4 {
        color: #004670;
        font-size: 21px;
        margin: 5px 0px;
        font-size: 24px;
        font-weight: 500;
        letter-spacing: 0px;
        line-height: 26px;
    }

    .srch_bar input {
        border: 1px solid #cdcdcd;
        border-width: 0 0 1px 0;
        width: 80%;
        padding: 2px 0 4px 6px;
        background: none;
    }

    .srch_bar .input-group-addon button {
        background: rgba(0, 0, 0, 0) none repeat scroll 0 0;
        border: medium none;
        padding: 0;
        color: #707070;
        font-size: 18px;
    }

    .srch_bar .input-group-addon {
        margin: 0 0 0 -27px;
    }

    .chat_ib h5 {
        font-size: 18px;
        color: #004670;
        margin: 0 0 8px 0;
        font-weight: 500;
        letter-spacing: 0px;
        margin-bottom: 3px;
    }

    .chat_ib h5 span {
        font-size: 13px;
        float: right;
    }

    .chat_ib p {
        font-size: 14px;
        color: #565656;
        margin: auto;
        display: inline-block;
        width: 100%;
        line-height: 19px;
        font-weight: 500;
    }

    .chat_img {
        float: left;
        width: 11%;
    }

    .chat_ib {
        float: left;
        padding: 0 0 0 15px;
        width: 88%;
    }

    .chat_people {
        float: left;
        width: 90%;
        clear: none;
    }

    .chat_list {
        border-bottom: 1px solid #c4c4c4;
        margin: 0;
        padding: 8px 16px 10px;
    }

    .inbox_chat {
        height: 550px;
        overflow-y: scroll;
    }

    .active_chat {
        background: #ebebeb;
    }

    .incoming_msg_img {
        display: inline-block;
        width: 6%;
    }

    .received_msg {
        display: inline-block;
        padding: 0 0 0 10px;
        vertical-align: top;
        width: 92%;
    }

    .received_withd_msg p {
        background: #ebebeb none repeat scroll 0 0;
        border-radius: 3px;
        color: #646464;
        font-size: 14px;
        margin: 0;
        padding: 10px 10px 10px 12px;
        width: 100%;
        font-weight: 500;
        line-height: 18px;
    }

    .time_date {
        color: #747474;
        display: block;
        font-size: 12px;
        margin: 8px 0 0;
    }

    .received_withd_msg {
        width: 57%;
    }

    .mesgs {
        float: left;
        padding: 30px 15px 0 25px;
        width: 100%;
    }

    .sent_msg p {
        background: #05728f none repeat scroll 0 0;
        border-radius: 3px;
        font-size: 14px;
        margin: 0;
        color: #fff;
        padding: 10px 10px 10px 12px;
        width: 100%;
        font-weight: 500;
        line-height: 18px;
    }

    .outgoing_msg {
        overflow: hidden;
        margin: 26px 0 26px;
    }

    .sent_msg {
        float: right;
        width: 46%;
    }

    .input_msg_write input {
        background: rgba(0, 0, 0, 0) none repeat scroll 0 0;
        border: medium none;
        color: #4c4c4c;
        font-size: 15px;
        min-height: 48px;
        width: 100%;
        background: #ebebeb;
        padding: 0px;
        margin-top: 5px;
        border-radius: 100px;
        padding: 0px 19px;
        font-weight: 500;
        margin-bottom: 00px;
        outline: none !important;
    }

    .type_msg {
        border-top: 0px solid #c4c4c4;
        position: relative;
    }

    .msg_send_btn {
        background: #45b955 none repeat scroll 0 0;
        border: medium none;
        border-radius: 50%;
        color: #fff;
        cursor: pointer;
        font-size: 17px;
        height: 33px;
        position: absolute;
        right: 0;
        top: 11px;
        width: 33px;
        margin-right: 12px;
    }

    .messaging {
        padding: 0 0 50px 0;
    }

    .msg_history {
        height: 516px;
        overflow-y: auto;
    }


    .messaging {
        padding: 0px 150px;
    }

    .backtitl_detl {

    }

    .backtitl_detl {

    }

    .backtitl_detl {

    }

    .backtitl_detl .chat_img {
        float: left;
        width: 7%;
    }

    .backtitl_detl h5 {
        font-size: 22px;
        display: inline-block;
        margin-top: 3px;
        margin-left: -2px;
        font-weight: 600;
    }

    .back_icon_as {
        float: left;
        margin-top: 16px;
        margin-right: 15px;
        width: 30px;
        height: 30px;
        background: #dcdcdc;
        text-align: center;
        line-height: 32px;
        border-radius: 100px;
        padding-right: 3px;
        color: #004670;
    }

    .back_icon_as i {

        float: left;
        font-size: 32px;
        margin-top: -1px;
        margin-left: -2px;
        color: #828282;
    }

    .input_msg_write {
        padding-bottom: 15px;
    }

    .repl_btn {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        background: #45b955;
        margin-top: 6px;
        border-radius: 100px;
        height: 46px;
        z-index: 9;
        text-align: center;
        font-size: 18px;
        line-height: 44px;
        padding-right: 10px;
        font-weight: 600;
        color: #fff;
        cursor: pointer;
    }

    .repl_btn:hover {
        background: #39a948;
    }

    .input_msg_write {
        position: relative;
    }

    .repl_btn_hide {
        display: none;
    }

    .subject_wrp {
        margin-top: 0px;
        float: left;
        width: 100%;
        margin-bottom: 4px;
    }

    .subject_titl {
        float: left;
        font-size: 14px;
        font-weight: 600;
        color: #004670;
        width: 70px;
    }

    .subject_text {
        float: left;
        font-size: 14px;
        margin-left: 5px;
        font-size: 14px;
        color: #9e9e9e;
        font-weight: 500;
        width: 80%;
        padding-left: 8px;
        line-height: 20px;
    }

    .subject_titl span {
        float: right;
    }


</style>
<script type="text/javascript">
    var compose_idg = '<?php echo $compose_id ?>';
    var last_idg = false;
    var send_by = send_to = '';
    <?php if(!empty($user_data)){ ?>
    var send_by = "<?php echo $user_data[0]['send_by']; ?>";
    var send_to = '<?php echo $user_data[0]['send_to']; ?>';
    <?php } ?>
</script>
<!-- breadcrumb start -->

<!-- breadcrumb End -->
<!--section start-->
<!-- section start -->
<section class="section-b-space">
    <div class="container container_detl_wdth container_detl_wdth_checkOut">
        <div class="containera">
            <div class="messaging">
                <?php
                if (!empty($user_data)) {
                    if ($user_data[0]['status'] == true) {
                        if (!empty($user_data[0]['compose_data'])) {
                            ?>
                            <div class="inbox_msg">

                                <div class="backtitl_detl chat_list">
                                    <a href="<?php echo base_url('admin/chat') ?>"
                                       class="back_icon_as">
                                        <i class="material-icons">arrow_left_alt</i>
                                    </a>
                                    <div class="chat_people">
                                        <div class="chat_img"><img
                                                src="https://ptetutorials.com/images/user-profile.png"
                                                alt="sunil"></div>
                                        <div class="chat_ib">
                                            <h5><?php echo $user_data[0]['compose_data'][0]['first_name']; ?> </h5>
                                            <div class="subject_wrp">
                                                <div class="subject_titl"> Subject
                                                    <span>:</span></div>
                                                <div class="subject_text">
                                                    <?php echo $user_data[0]['compose_data'][0]['subject']; ?>
                                                </div>
                                                <div class="clear"></div>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="clear"></div>
                                </div>

                                <?Php if (!empty($user_data[0]['chat_data'])) { ?>
                                    <div class="mesgs">

                                        <div class="msg_history" id="app_message">
                                            <?php foreach ($user_data[0]['chat_data'] as $cd_key => $cd_val) {
                                                if ($user_data[0]['id'] == $cd_val['user_id']) { ?>
                                                    <div class="outgoing_msg"
                                                         id="single_msg<?php echo $cd_val['id']; ?>">
                                                        <div class="sent_msg">
                                                            <p><?php echo $cd_val['message']; ?></p>
                                                            <span
                                                                class="time_date"><?php echo date('h:i', strtotime($cd_val['created_date'])); ?>    | <?php echo date('M d', strtotime($cd_val['created_date'])); ?></span>
                                                        </div>
                                                    </div>
                                                <?php } else { ?>
                                                    <div class="incoming_msg"
                                                         id="single_msg<?php echo $cd_val['id']; ?>">
                                                        <!-- <div class="incoming_msg_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil"> </div> -->
                                                        <div class="received_msg">
                                                            <div
                                                                class="received_withd_msg">
                                                                <p><?php echo $cd_val['message']; ?></p>
                                                                <span
                                                                    class="time_date"><?php echo date('h:i', strtotime($cd_val['created_date'])); ?>    | <?php echo date('M d', strtotime($cd_val['created_date'])); ?></span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                <?php }
                                            } ?>
                                            <script type="text/javascript">
                                                last_idg = '<?php echo $cd_val['id']; ?>';
                                            </script>
                                        </div>
                                        <div class="type_msg">
                                            <div class="input_msg_write">
                                                <form id="send_form">
                                                    <div class="repl_btn">
                                                        <i class="fa fa-reply"
                                                           aria-hidden="true"></i> Reply
                                                    </div>
                                                    <input type="text" id="type_text"
                                                           class="write_msg space"
                                                           placeholder="Type a message"/>
                                                    <button class="msg_send_btn"
                                                            type="submit"><i
                                                            class="fa fa-paper-plane-o"
                                                            aria-hidden="true"></i>
                                                    </button>
                                                </form>
                                            </div>

                                        </div>
                                    </div>
                                <?php } else { ?>
                                    <h2 class="text-center text-danger">No message
                                        found</h2>
                                <?php } ?>
                            </div>
                        <?php } else { ?>
                            <h2 class="text-center text-danger">No Compose message
                                found</h2>
                        <?php }
                    } else { ?>
                        <h2 class="text-center text-danger">Your account is deactive
                            please contact to admin</h2>
                    <?php }
                } else { ?>
                    <h2 class="text-center text-danger">Please login or invalid
                        user </h2>
                <?php } ?>
            </div>
        </div>
    </div>
</section>

<!-- section end -->
<script>
    $(".repl_btn").click(function () {
        $(".repl_btn").addClass("repl_btn_hide");
    });
</script>

<script type="text/javascript">
    $(document).on("submit", "#send_form", function (e) {
        e.preventDefault();
        var creceiver = '<?php echo $user_data[0]['compose_data'][0]['csender_id']; ?>';
        // var id =$(this).attr("data-id");
        var message = $.trim($("#type_text").val());
        if (message == '') {
            swal("", "Please Type message", 'warning');
        } else {
            message_send(message, compose_idg, creceiver);
        }
    });


    function message_send(message, compose_idg, creceiver) {
        $.ajax({
            type: 'POST',
            url: "<?php echo base_url('admin/chat/user_chat'); ?>",
            data: {
                message: message,
                'compose_id': compose_idg,
                creceiver: creceiver,
                'send_by': send_by,
                'send_to': send_to
            },
            success: function (response) {
                var html = '';
                var response = $.parseJSON(response);
                if (response.status == true) {
                    $("#type_text").val('');

                    html += '<div class="outgoing_msg" id="single_msg' + response.message[0].id + '">';
                    html += '<div class="sent_msg">';
                    html += '<p>' + response.message[0].message + '</p>';
                    html += '<span class="time_date">' + response.message[0].last_time + ' | ' + response.message[0].last_mon_day + '</span> ';
                    html += '</div>';
                    html += '</div>';

                    $("#app_message").append(html);
                    var out = $("#app_message");
                    if (1) {
                        out[0].scrollTop = out[0].scrollHeight - out[0].clientHeight;
                    }
                } else {
                    swal("", response.message, 'warning');
                }
            }
        });
    }
</script>

<script type="text/javascript">
    setInterval(live_message, 5000);

    function live_message() {
        $.ajax({
            type: 'POST',
            url: "<?php echo base_url('admin/chat/live_message'); ?>",
            data: {'compose_id': compose_idg, 'last_id': last_idg},
            success: function (response) {
                var html = '';
                var response = $.parseJSON(response);
                if (response.status == true) {
                    var chat_data = response.message;
                    // var last_idl=chat_data.message[0]['id'];
                    last_idg = chat_data[0].id;
                    $.each(chat_data, function (k, v) {
                        if ($("#single_msg" + v.id).length == 0) {

                            html += '<div class="incoming_msg" id="single_msg' + v.id + '">';
                            html += '<div class="received_msg">';
                            html += '<div class="received_withd_msg">';
                            html += '<p>' + v.message + '</p>';
                            html += '<span class="time_date">' + v.last_time + ' | ' + v.last_mon_day + '</span>';
                            html += '</div>';
                            html += '</div>';
                            html += '</div>';
                            $("#app_message").append(html);
                            var out = $("#app_message");
                            if (1) {
                                out[0].scrollTop = out[0].scrollHeight - out[0].clientHeight;
                            }
                        }

                    });
                }
            }
        });
    }
</script>
